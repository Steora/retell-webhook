// import express from "express";
// const app = express();

// // Middleware to parse JSON bodies from Retell
// app.use(express.json());

// app.post("/retell-webhook", async (req, res) => {
//   try {
//     // Retell sends the function name and arguments in the body
//     const { name, args } = req.body;
    
//     console.log(`\nðŸ”¹ Function Triggered: ${name}`);
//     console.log(`ðŸ”¸ Parameters:`, JSON.stringify(args, null, 2));

//     let responseMessage = "";

//     // ROUTER LOGIC
//     switch (name) {
      
//       // Case 1: Send Website Link
//       case "send_website_link":
//         // Logic: specific code to send email via SendGrid/Mailgun
//         console.log(`>> Sending website link to: ${args.email}`);
//         responseMessage = "I have sent the website link to your email.";
//         break;

//       // Case 2: End Call
//       case "end_call":
//         // Logic: Log the call termination or clean up database records
//         console.log(">> Agent requested call termination.");
//         responseMessage = "The call is ending now. Goodbye.";
//         break;

//       // Case 3: Submit VideoPlus Order (Complex Form)
//       case "submit_videoplus_order":
//         // Logic: Save this huge object to your database (Airtable, MongoDB, etc.)
//         handleOrderSubmission(args); 
//         responseMessage = `Thank you. I have submitted the order for the ${args.style_of_cause} case. You will receive a confirmation at ${args.ordering_party_email}.`;
//         break;

//       // Case 4: Send Support Ticket
//       case "send_support_ticket":
//         // Logic: Create a ticket in Zendesk/Jira
//         console.log(`>> Creating ticket for ${args.user_name}: ${args.issue_details}`);
//         responseMessage = "I've created a support ticket for your issue. Our team will contact you shortly.";
//         break;

//       default:
//         console.log("Unknown function called");
//         responseMessage = "Function execution failed.";
//     }

//     // Return the result to Retell so the Voice Agent knows what to say next
//     res.json({
//       result: responseMessage
//     });

//   } catch (error) {
//     console.error("Error processing webhook:", error);
//     res.status(500).json({ error: "Internal Server Error" });
//   }
// });

// // Helper function to handle the large order object
// function handleOrderSubmission(data) {
//     // This is where you would normally save to a database
//     // Access fields like: data.court_file_number, data.judge_name, etc.
//     console.log(`>> PROCESSING ORDER:`);
//     console.log(`   Case: ${data.style_of_cause}`);
//     console.log(`   Due: ${data.due_date} (${data.expedited_service === 'yes' ? 'URGENT' : 'Standard'})`);
//     console.log(`   Contact: ${data.ordering_party_name} (${data.ordering_party_phone})`);
    
//     // TODO: Add your database insert code here
// }

// // Start the server
// const PORT = process.env.PORT || 8080;
// app.listen(PORT, () => console.log(`Server running on port ${PORT}`));


// import express from "express";
// import { google } from "googleapis";

// const app = express();
// app.use(express.json());

// // --- CONFIGURATION ---
// const SPREADSHEET_ID = "YOUR_SHEET_ID_HERE"; // Paste your Sheet ID here
// const KEY_FILE_PATH = "./credentials.json";  // Ensure this file is in your folder

// // --- GOOGLE SHEETS AUTHENTICATION ---
// const auth = new google.auth.GoogleAuth({
//   keyFile: KEY_FILE_PATH,
//   scopes: ["https://www.googleapis.com/auth/spreadsheets"],
// });

// async function appendToSheet(values) {
//   const sheets = google.sheets({ version: "v4", auth });
//   await sheets.spreadsheets.values.append({
//     spreadsheetId: SPREADSHEET_ID,
//     range: "Sheet1!A:A", // Adjust if your tab name is different
//     valueInputOption: "USER_ENTERED",
//     requestBody: {
//       values: [values], // Google expects an array of arrays (rows)
//     },
//   });
// }

// // --- WEBHOOK ENDPOINT ---
// app.post("/retell-webhook", async (req, res) => {
//   try {
//     const { name, args } = req.body;
//     console.log(`\nðŸ”¹ Function Triggered: ${name}`);

//     let responseMessage = "";

//     switch (name) {
//       case "submit_videoplus_order":
//         // 1. Prepare the row data (Order matches your Sheet Headers)
//         const orderRow = [
//           new Date().toISOString(),     // Timestamp
//           args.style_of_cause,          // Case Name
//           args.court_file_number,       // File #
//           args.court_location,          // Location
//           args.court_type,              // Court Type
//           args.proceeding_dates,        // Dates
//           args.judge_name,              // Judge
//           args.due_date,                // Due Date
//           args.expedited_service,       // Expedited?
//           args.ordering_party_name,     // Contact Name
//           args.ordering_party_email,    // Contact Email
//           args.ordering_party_phone     // Contact Phone
//           // Add remaining fields here in the exact order of your columns
//         ];

//         // 2. Send to Google Sheets
//         await appendToSheet(orderRow);
        
//         console.log(">> Order saved to Google Sheets");
//         responseMessage = `Order submitted successfully for ${args.style_of_cause}. A confirmation has been sent to ${args.ordering_party_email}.`;
//         break;

//       case "send_website_link":
//          // (You can also log this to a different sheet tab if you want)
//          responseMessage = "Link sent.";
//          break;
         
//       case "end_call":
//          responseMessage = "Ending call.";
//          break;

//       case "send_support_ticket":
//          // Add support ticket logic here
//          responseMessage = "Ticket created.";
//          break;

//       default:
//         responseMessage = "Function execution failed.";
//     }

//     res.json({ result: responseMessage });

//   } catch (error) {
//     console.error("Error:", error);
//     res.status(500).json({ error: "Internal Server Error" });
//   }
// });

// const PORT = process.env.PORT || 8080;
// app.listen(PORT, () => console.log(`Server running on port ${PORT}`));